// Generated by wit-bindgen-moonbit

/// Export trait for primitives
pub(open) trait Exports {
  echo_bool(Self, val : Bool) -> Bool
  echo_f32(Self, val : Float) -> Float
  echo_f64(Self, val : Double) -> Double
  echo_s32(Self, val : Int) -> Int
  echo_s64(Self, val : Int64) -> Int64
  echo_string(Self, val : String) -> String
}

let exports_impl : Ref[&Exports?] = { val: None }

pub fn register(impl_ : &Exports) -> Unit {
  exports_impl.val = Some(impl_)
}

pub fn get_exports() -> &Exports {
  guard exports_impl.val is Some(impl_) else {
    abort("exports not registered")
  }
  impl_
}

pub fn wasmExportEchoBool(val : Bool) -> Bool {
  get_exports().echo_bool(val)
}

pub fn wasmExportEchoF32(val : Float) -> Float {
  get_exports().echo_f32(val)
}

pub fn wasmExportEchoF64(val : Double) -> Double {
  get_exports().echo_f64(val)
}

pub fn wasmExportEchoS32(val : Int) -> Int {
  get_exports().echo_s32(val)
}

pub fn wasmExportEchoS64(val : Int64) -> Int64 {
  get_exports().echo_s64(val)
}

pub fn wasmExportEchoString(val_ptr : Int, val_len : Int) -> Int {
  let val = @cabi.cabi_lift_string(val_ptr, val_len)
  let result = get_exports().echo_string(val)
  let (ptr, len) = @cabi.cabi_lower_string(result)
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  @cabi.cabi_write_i32(retptr, ptr)
  @cabi.cabi_write_i32(retptr + 4, len)
  retptr
}

