// Generated by wit-bindgen-moonbit

///|
pub struct Permissions {
  read : Bool
  write : Bool
  execute : Bool
} derive(Show, Eq)

///| Lift Permissions from bitmask
pub fn Permissions::from_bits(bits : Int) -> Permissions {
  {
    read: (bits & 1) != 0,
    write: (bits & 2) != 0,
    execute: (bits & 4) != 0,
  }
}

///| Lower Permissions to bitmask
pub fn Permissions::to_bits(self : Permissions) -> Int {
  let mut bits = 0
  if self.read { bits = bits | 1 }
  if self.write { bits = bits | 2 }
  if self.execute { bits = bits | 4 }
  bits
}

/// Export trait for flags-test
pub(open) trait Exports {
  echo_permissions(Self, p : Permissions) -> Permissions
  has_read(Self, p : Permissions) -> Bool
  has_write(Self, p : Permissions) -> Bool
}

let exports_impl : Ref[&Exports?] = { val: None }

pub fn register(impl_ : &Exports) -> Unit {
  exports_impl.val = Some(impl_)
}

pub fn get_exports() -> &Exports {
  guard exports_impl.val is Some(impl_) else {
    abort("exports not registered")
  }
  impl_
}

pub fn wasmExportEchoPermissions(p : Int) -> Int {
  let p = Permissions::from_bits(p)
  get_exports().echo_permissions(p).to_bits()
}

pub fn wasmExportHasRead(p : Int) -> Bool {
  let p = Permissions::from_bits(p)
  get_exports().has_read(p)
}

pub fn wasmExportHasWrite(p : Int) -> Bool {
  let p = Permissions::from_bits(p)
  get_exports().has_write(p)
}

