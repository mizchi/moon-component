# Swift Host Integration Test

This directory contains a Swift-based host for testing WebAssembly modules generated by moon-component.

## Prerequisites

- Swift 5.9+
- macOS 14+ (for WasmKit 0.2.0 compatibility)

## Building

```bash
# Build the types-test wasm first
cd ../types-test
moon build --target wasm

# Build swift host
cd ../swift-host
swift build
```

## Running

```bash
# Run with default path
swift run SwiftHost

# Run with custom wasm path
swift run SwiftHost ../types-test/_build/wasm/release/build/src/src.wasm

# Release build for better performance
swift build -c release
.build/release/SwiftHost
```

## Test Coverage

The Swift host tests the **core wasm module** (before componentization) using WasmKit:

### Primitives
- `echo-s32`: i32 echo
- `echo-s64`: i64 echo
- `echo-f32`: f32 echo
- `echo-f64`: f64 echo
- `echo-bool`: bool echo (as i32)

### Enums
- `echo-color`: enum value echo (as i32 discriminant)

### Flags
- `has-read`: check read permission bit
- `has-write`: check write permission bit
- `echo-permissions`: flags bitmask echo

### Multi-params
- `add2`: 2 parameter addition
- `add3`: 3 parameter addition
- `add4`: 4 parameter addition

## Architecture

```
┌─────────────┐      ┌──────────────────┐      ┌──────────────┐
│ Swift Host  │──────│    WasmKit       │──────│   Core Wasm  │
│  (main.swift)│     │ (Pure Swift)     │      │   Module     │
└─────────────┘      └──────────────────┘      └──────────────┘
       │                                              │
       │         Function calls (i32, i64, etc.)      │
       └──────────────────────────────────────────────┘
```

## Dependencies

- [WasmKit](https://github.com/swiftwasm/WasmKit) - Pure Swift WebAssembly runtime

## Notes

- WasmKit is a pure Swift implementation, no C dependencies required
- Tests run the actual wasm functions (not just binary validation)
- For component-level testing (with full canonical ABI), use the Rust host in `../rust-host`
