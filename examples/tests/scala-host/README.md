# Scala Host Integration Test

This directory contains a Scala-based host for testing WebAssembly modules generated by moon-component.

## Prerequisites

- JDK 11+
- sbt 1.10+

## Building

```bash
# Build the types-test wasm first
cd ../types-test
moon build --target wasm

# Build scala host
cd ../scala-host
sbt compile
```

## Running

```bash
# Run with default path
sbt run

# Run with custom wasm path
sbt "run ../types-test/_build/wasm/release/build/src/src.wasm"
```

## Test Coverage

The Scala host tests the **core wasm module** (before componentization) using Chicory:

### Primitives
- `echo-s32`: i32 echo
- `echo-s64`: i64 echo
- `echo-f32`: f32 echo
- `echo-f64`: f64 echo
- `echo-bool`: bool echo (as i32)

### Enums
- `echo-color`: enum value echo (as i32 discriminant)

### Flags
- `has-read`: check read permission bit
- `has-write`: check write permission bit
- `echo-permissions`: flags bitmask echo

### Multi-params
- `add2`: 2 parameter addition
- `add3`: 3 parameter addition
- `add4`: 4 parameter addition

## Architecture

```
┌─────────────┐      ┌──────────────────┐      ┌──────────────┐
│ Scala Host  │──────│    Chicory       │──────│   Core Wasm  │
│  (Main.scala)│     │ (Pure Java)      │      │   Module     │
└─────────────┘      └──────────────────┘      └──────────────┘
       │                                              │
       │         Function calls (i32, i64, etc.)      │
       └──────────────────────────────────────────────┘
```

## Dependencies

- [Chicory](https://github.com/dylibso/chicory) - Pure Java WebAssembly runtime (no native dependencies)

## Notes

- Chicory is a pure Java implementation, no native dependencies required
- Tests run the actual wasm functions (not just binary validation)
- For component-level testing (with full canonical ABI), use the Rust host in `../rust-host`
