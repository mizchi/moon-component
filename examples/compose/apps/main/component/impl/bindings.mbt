// Generated by moon-component
// DO NOT EDIT - this file is regenerated

/// Export trait for api
pub(open) trait Exports {
  calc_add(Self, a : Int, b : Int) -> Int
  calc_factorial(Self, n : UInt) -> UInt64
  calc_multiply(Self, a : Int, b : Int) -> Int
  describe_factorial(Self, n : UInt) -> String
  str_repeat(Self, s : String, n : UInt) -> String
  str_reverse(Self, s : String) -> String
  str_uppercase(Self, s : String) -> String
}

let exports_impl : Ref[&Exports?] = { val: None }

pub fn register(impl_ : &Exports) -> Unit {
  exports_impl.val = Some(impl_)
}

fn get_exports() -> &Exports {
  guard exports_impl.val is Some(impl_) else {
    abort("exports not registered")
  }
  impl_
}

///| Re-export cabi_realloc for wasm linking
pub fn cabi_realloc(
  old_ptr : Int,
  old_size : Int,
  align : Int,
  new_size : Int,
) -> Int {
  @cabi.cabi_realloc(old_ptr, old_size, align, new_size)
}

pub fn wasmExportCalcAdd(a : Int, b : Int) -> Int {
  get_exports().calc_add(a, b)
}

pub fn wasmExportCalcFactorial(n : Int) -> Int64 {
  get_exports().calc_factorial(n.reinterpret_as_uint()).reinterpret_as_int64()
}

pub fn wasmExportCalcMultiply(a : Int, b : Int) -> Int {
  get_exports().calc_multiply(a, b)
}

pub fn wasmExportDescribeFactorial(n : Int) -> Int {
  let result = get_exports().describe_factorial(n.reinterpret_as_uint())
  let (ptr, len) = @cabi.cabi_lower_string(result)
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  @cabi.cabi_write_i32(retptr, ptr)
  @cabi.cabi_write_i32(retptr + 4, len)
  retptr
}

pub fn wasmExportStrRepeat(s_ptr : Int, s_len : Int, n : Int) -> Int {
  let s = @cabi.cabi_lift_string(s_ptr, s_len)
  let result = get_exports().str_repeat(s, n.reinterpret_as_uint())
  let (ptr, len) = @cabi.cabi_lower_string(result)
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  @cabi.cabi_write_i32(retptr, ptr)
  @cabi.cabi_write_i32(retptr + 4, len)
  retptr
}

pub fn wasmExportStrReverse(s_ptr : Int, s_len : Int) -> Int {
  let s = @cabi.cabi_lift_string(s_ptr, s_len)
  let result = get_exports().str_reverse(s)
  let (ptr, len) = @cabi.cabi_lower_string(result)
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  @cabi.cabi_write_i32(retptr, ptr)
  @cabi.cabi_write_i32(retptr + 4, len)
  retptr
}

pub fn wasmExportStrUppercase(s_ptr : Int, s_len : Int) -> Int {
  let s = @cabi.cabi_lift_string(s_ptr, s_len)
  let result = get_exports().str_uppercase(s)
  let (ptr, len) = @cabi.cabi_lower_string(result)
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  @cabi.cabi_write_i32(retptr, ptr)
  @cabi.cabi_write_i32(retptr + 4, len)
  retptr
}

///|
fn main {
  ()
}
