# Zig Host Integration Test

This directory contains a Zig-based WebAssembly binary validator for testing modules generated by moon-component.

## Prerequisites

- Zig 0.15+

## Building

```bash
# Build the types-test wasm first
moon build --target wasm --release --directory examples/tests/types-test

# Build zig host
cd examples/host/zig
zig build
```

## Running

```bash
# Run with default path
zig build run

# Run with custom wasm path
zig build run -- ../../tests/types-test/_build/wasm/release/build/src/src.wasm

# Run unit tests
zig build test
```

## What This Tests

The Zig host validates the **wasm binary structure** without requiring a full wasm runtime:

### Validation Checks
- Magic number and version
- Export section parsing
- Expected function exports match WIT specification

### Expected Exports
- `memory`, `cabi_realloc`, `_start`
- Primitives: `echo-s32`, `echo-s64`, `echo-f32`, `echo-f64`, `echo-bool`, `echo-string`
- Enums: `echo-color`, `color-name`
- Flags: `echo-permissions`, `has-read`, `has-write`
- Multi-params: `add2`, `add3`, `add4`, `concat3`, `mixed-params`
- Containers: `sum-list`, `divide`
- Side-effects: `no-return`, `no-params-no-return`

## Architecture

```
┌─────────────┐      ┌──────────────────┐
│  Zig Host   │──────│   Wasm Binary    │
│  (main.zig) │      │   (no runtime)   │
└─────────────┘      └──────────────────┘
       │
       │  Parse binary format
       │  Validate export names
       │
       └──────────────────────────────────
```

This tests the generated code structure, validating:
- Wasm binary format is correct
- Function export names follow WIT naming (`namespace:package/interface#function`)
- Required exports (memory, cabi_realloc) are present

For runtime testing (actually executing functions), use:
- Rust host (`../rust`) - Full component model support
- Node.js/Deno - Simple wasm execution
