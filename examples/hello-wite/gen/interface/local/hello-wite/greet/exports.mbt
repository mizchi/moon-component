// Generated by wit-bindgen-moonbit

/// Export trait for greet
pub(open) trait Exports {
  greet(Self, name : String) -> String
}

let exports_impl : Ref[&Exports?] = { val: None }

pub fn register(impl_ : &Exports) -> Unit {
  exports_impl.val = Some(impl_)
}

pub fn get_exports() -> &Exports {
  guard exports_impl.val is Some(impl_) else {
    abort("exports not registered")
  }
  impl_
}

pub fn wasmExportGreet(name_ptr : Int, name_len : Int) -> Int {
  let name = @cabi.cabi_lift_string(name_ptr, name_len)
  let result = get_exports().greet(name)
  let (ptr, len) = @cabi.cabi_lower_string(result)
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  @cabi.cabi_write_i32(retptr, ptr)
  @cabi.cabi_write_i32(retptr + 4, len)
  retptr
}
